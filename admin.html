<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master Admin - All Buttons Fixed</title>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <style>
        body { background: #0a0a0a; color: white; font-family: sans-serif; margin: 0; padding-bottom: 30px; }
        .header { background: #111; padding: 15px; text-align: center; border-bottom: 2px solid #ffd700; }
        
        /* Navigation Tabs Fixed */
        .nav-tabs { display: flex; background: #1a1a1a; overflow-x: auto; padding: 10px; gap: 8px; position: sticky; top: 0; z-index: 100; scrollbar-width: none; }
        .nav-tabs::-webkit-scrollbar { display: none; }
        .tab-btn { flex-shrink: 0; background: #333; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; font-size: 12px; }
        .tab-btn.active { background: #ffd700; color: black; font-weight: bold; }
        .tab-users { background: #ffd700 !important; color: black !important; font-weight: bold; }

        .content-section { display: none; padding: 15px; }
        .active-section { display: block; }

        .card { background: #151515; padding: 15px; border-radius: 12px; border: 1px solid #333; margin-bottom: 15px; }
        h3 { margin: 0 0 15px 0; color: #ffd700; font-size: 16px; border-left: 4px solid #ffd700; padding-left: 10px; }
        
        input, select { width: 92%; padding: 12px; margin: 8px 0; background: #222; color: white; border: 1px solid #444; border-radius: 6px; }
        .btn { padding: 12px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-green { background: #2ecc71; color: white; width: 100%; }
        .btn-red { background: #e74c3c; color: white; width: 100%; }
        
        /* User Table Style */
        .user-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 11px; }
        .user-table th { background: #333; color: #ffd700; padding: 10px; text-align: left; border-bottom: 2px solid #444; }
        .user-table td { padding: 10px; border-bottom: 1px solid #222; }
        
        /* Game Control Buttons */
        .game-btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .g-btn { padding: 15px 5px; border-radius: 8px; border: 1px solid #444; background: #222; color: white; font-size: 12px; font-weight: bold; }
        .g-active { border-color: #ffd700; background: #332b00; color: #ffd700; }

        .req-box { background: #222; padding: 12px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid #ffd700; font-size: 13px; }
    </style>
</head>
<body>

<div class="header"><h3>üíé MASTER ADMIN PANEL</h3></div>

<div class="nav-tabs">
    <button class="tab-btn active" onclick="openTab(event, 'game-ctrl')">üéÆ GAME</button>
    <button class="tab-btn" onclick="openTab(event, 'money-ctrl')">üí∞ WALLET</button>
    <button class="tab-btn" onclick="openTab(event, 'req-ctrl')">üì© REQ</button>
    <button class="tab-btn tab-users" onclick="openTab(event, 'users-list')">üë• USERS</button>
</div>

<div id="game-ctrl" class="content-section active-section">
    <div class="card">
        <h3>üêØ Dragon Tiger Control</h3>
        <div class="game-btn-grid">
            <button class="g-btn" id="dt-auto" onclick="fixGame('dvt', 'auto')">AUTO (Profit Mode)</button>
            <button class="g-btn" id="dt-dragon" onclick="fixGame('dvt', 'dragon')">DRAGON WIN</button>
            <button class="g-btn" id="dt-tiger" onclick="fixGame('dvt', 'tiger')">TIGER WIN</button>
            <button class="g-btn" id="dt-tie" onclick="fixGame('dvt', 'tie')">TIE WIN</button>
        </div>
    </div>

    <div class="card">
        <h3>üÉè Andar Bahar Control</h3>
        <div class="game-btn-grid">
            <button class="g-btn" id="ab-auto" onclick="fixGame('andar_bahar', 'auto')">AUTO (Profit Mode)</button>
            <button class="g-btn" id="ab-andar" onclick="fixGame('andar_bahar', 'andar')">ANDAR WIN</button>
            <button class="g-btn" id="ab-bahar" onclick="fixGame('andar_bahar', 'bahar')">BAHAR WIN</button>
        </div>
    </div>
    
    <div class="card">
        <h3>üîó Support Links</h3>
        <input type="text" id="waLink" placeholder="WhatsApp Link">
        <input type="text" id="tgLink" placeholder="Telegram Link">
        <button class="btn btn-green" onclick="updateSupport()">Save Links</button>
    </div>
</div>

<div id="money-ctrl" class="content-section">
    <div class="card">
        <h3>üíµ Quick Balance (Add/Cut)</h3>
        <input type="text" id="userPhone" placeholder="Player ID (Phone)">
        <input type="number" id="newAmt" placeholder="Amount">
        <div style="display: flex; gap:10px;">
            <button class="btn btn-green" onclick="modifyWallet('add')">‚ûï ADD</button>
            <button class="btn btn-red" onclick="modifyWallet('cut')">‚ûñ CUT</button>
        </div>
    </div>
    <div class="card">
        <h3>üè¶ Payment QR/UPI</h3>
        <input type="text" id="adminUpi" placeholder="Your UPI ID">
        <input type="text" id="qrUrl" placeholder="QR Image Link">
        <button class="btn btn-green" onclick="updatePayment()">Save Payment Info</button>
    </div>
</div>

<div id="req-ctrl" class="content-section">
    <div class="card">
        <h3>üì• Deposit & Withdraw Requests</h3>
        <div id="request-list">No pending requests.</div>
    </div>
</div>

<div id="users-list" class="content-section">
    <div class="card">
        <h3>üë• Registered Players (Live)</h3>
        <div style="overflow-x: auto;">
            <table class="user-table">
                <thead>
                    <tr>
                        <th>Phone</th>
                        <th>Pass</th>
                        <th>Wallet</th>
                        <th>ID</th>
                    </tr>
                </thead>
                <tbody id="all-users-data">
                    </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = { 
        apiKey: "AIzaSyCy2zsDDJeVTQEbHCenkLIlz3lWWyo-Pqo", 
        databaseURL: "https://kalyan-casino-default-rtdb.firebaseio.com", 
        projectId: "kalyan-casino" 
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function openTab(evt, name) {
        let i, content, tabs;
        content = document.getElementsByClassName("content-section");
        for (i = 0; i < content.length; i++) content[i].classList.remove("active-section");
        tabs = document.getElementsByClassName("tab-btn");
        for (i = 0; i < tabs.length; i++) tabs[i].classList.remove("active");
        document.getElementById(name).classList.add("active-section");
        evt.currentTarget.classList.add("active");
    }

    // Live User Fetching Logic
    db.ref('users').on('value', snap => {
        const userBody = document.getElementById('all-users-data');
        userBody.innerHTML = "";
        const data = snap.val();
        if(!data) { userBody.innerHTML = "<tr><td colspan='4'>No players.</td></tr>"; return; }

        Object.keys(data).forEach(ph => {
            const u = data[ph];
            userBody.innerHTML += `
                <tr>
                    <td>${ph}</td>
                    <td style="color:#ffd700">${u.pass || u.password || '---'}</td>
                    <td style="color:#2ecc71">‚Çπ${u.wallet || 0}</td>
                    <td>${u.id || '---'}</td>
                </tr>`;
        });
    });

    function fixGame(path, val) {
        db.ref('game_settings/' + path).update({ mode: val === 'auto' ? 'auto' : 'manual', next: val });
        alert("Success: " + val);
    }

    function modifyWallet(action) {
        const phone = document.getElementById('userPhone').value;
        const amt = parseFloat(document.getElementById('newAmt').value);
        if(!phone || isNaN(amt)) return alert("Data sahi bharo!");

        db.ref('users/' + phone + '/wallet').once('value', s => {
            let current = s.val() || 0;
            let final = action === 'add' ? current + amt : current - amt;
            db.ref('users/' + phone + '/wallet').set(final);
            alert("Done!");
        });
    }

    db.ref('requests').on('value', snap => {
        const list = document.getElementById('request-list');
        list.innerHTML = "";
        const data = snap.val();
        if(!data) { list.innerHTML = "No requests."; return; }

        Object.keys(data).forEach(id => {
            const r = data[id];
            list.innerHTML += `<div class="req-box">
                <b>${r.type.toUpperCase()}</b> | ID: ${r.phone} | Amt: ‚Çπ${r.amount} <br>
                <div style="display:flex; gap:5px; margin-top:5px;">
                    <button class="btn btn-green" onclick="approveReq('${id}','${r.phone}',${r.amount},'${r.type}')">OK</button>
                    <button class="btn btn-red" onclick="db.ref('requests/${id}').remove()">X</button>
                </div>
            </div>`;
        });
    });

    function approveReq(id, phone, amt, type) {
        if(type === 'deposit') {
            db.ref('users/'+phone+'/wallet').once('value', s => {
                db.ref('users/'+phone+'/wallet').set((s.val()||0) + amt);
            });
        }
        db.ref('requests/'+id).remove(); alert("Success!");
    }

    function updatePayment() {
        db.ref('admin_settings/payment').set({ 
            upi: document.getElementById('adminUpi').value, 
            qr: document.getElementById('qrUrl').value 
        }); alert("Saved!");
    }

    function updateSupport() {
        db.ref('admin_settings/support').set({ 
            whatsapp: document.getElementById('waLink').value, 
            telegram: document.getElementById('tgLink').value 
        }); alert("Links Saved!");
    }
</script>
</body>
</html>
