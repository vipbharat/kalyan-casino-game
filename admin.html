<script>
    // Firebase Config (Aapka Wala)
    const firebaseConfig = { 
        apiKey: "AIzaSyCy2zsDDJeVTQEbHCenkLIlz3lWWyo-Pqo", 
        databaseURL: "https://kalyan-casino-default-rtdb.firebaseio.com", 
        projectId: "kalyan-casino" 
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // ✅ 1. GAME CONTROL (Ab ye Wallet ki tarah Direct kaam karega)
    function gameAction(game, res) {
        // Humne Dragon Tiger aur Andar Bahar dono ke paths ko merge kar diya hai
        if(game === 'dvt') {
            db.ref('games/dragon_tiger').update({ result: res, winning: res });
            db.ref('game_settings/dvt').update({ result: res });
        } else {
            db.ref('games/andar_bahar').update({ result: res, winning: res });
            db.ref('manual_result_ab').set(res);
        }
        alert("Success: " + res);
    }

    // ✅ 2. NOTICE BOARD (Direct Path)
    function saveNotice() {
        const msg = document.getElementById('notifMsg').value;
        // Ye path check karo, marquee yahi se chalti hai
        db.ref('admin_settings/notification').set(msg)
          .then(() => alert("Notice Saved!"))
          .catch((e) => alert("Error: " + e.message));
    }

    // ✅ 3. SETTINGS (UPI & QR)
    function saveAdminSettings() {
        db.ref('admin_settings').update({
            upi: document.getElementById('adminUpi').value,
            qr: document.getElementById('qrUrl').value,
            whatsapp: document.getElementById('waLink').value,
            telegram: document.getElementById('tgLink').value
        }).then(() => alert("Settings Saved!"));
    }

    // ✅ 4. WALLET (Jo aapka kaam kar raha hai)
    function modifyWallet(action) {
        const ph = document.getElementById('userPhone').value;
        const amt = parseFloat(document.getElementById('newAmt').value);
        if(!ph) return alert("Phone Number daalo");
        
        db.ref('users/' + ph + '/balance').transaction(b => {
            return action === 'add' ? (parseFloat(b) || 0) + amt : (parseFloat(b) || 0) - amt;
        }).then(() => alert("Balance Updated!"));
    }

    // ✅ 5. REQUESTS (Approve/Reject)
    db.ref('requests').on('value', s => {
        let h = "";
        s.forEach(c => {
            let r = c.val(); let id = c.key;
            h += `<tr><td>${r.phone}</td><td>${r.type}</td><td>₹${r.amount}</td>
            <td><button onclick="handleReq('${id}','${r.phone}',${r.amount},'${r.type}','ok')">✔</button></td></tr>`;
        });
        document.getElementById('master-request-body').innerHTML = h;
    });

    function handleReq(id, ph, amt, type, action) {
        if(type === 'Deposit') {
            db.ref('users/'+ph+'/balance').transaction(b => (parseFloat(b)||0)+amt);
        }
        db.ref('requests/'+id).remove();
        alert("Done!");
    }

    // ✅ 6. USERS LIST
    db.ref('users').on('value', s => {
        let h = ""; 
        s.forEach(c => { 
            let d = c.val();
            h += `<tr><td>${c.key}</td><td>₹${(d.balance||0).toFixed(2)}</td></tr>`; 
        });
        document.getElementById('all-users-data').innerHTML = h;
    });

    // Tab Switcher
    function openTab(evt, name) {
        let content = document.getElementsByClassName("content-section");
        for (let i = 0; i < content.length; i++) content[i].style.display = "none";
        document.getElementById(name).style.display = "block";
        let tabs = document.getElementsByClassName("tab-btn");
        for (let i = 0; i < tabs.length; i++) tabs[i].classList.remove("active");
        evt.currentTarget.classList.add("active");
    }
</script>
