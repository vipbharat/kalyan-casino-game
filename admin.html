<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KALYAN PRO - MASTER ADMIN</title>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; margin: 0; overflow: hidden; }
        .main-wrapper { display: flex; width: 400vw; height: 100vh; transition: 0.4s ease; }
        .page { width: 100vw; height: 100vh; padding: 20px; box-sizing: border-box; overflow-y: auto; padding-bottom: 80px; }
        
        .nav-bar { position: fixed; bottom: 15px; left: 50%; transform: translateX(-50%); display: flex; gap: 15px; z-index: 100; background: rgba(0,0,0,0.8); padding: 10px 20px; border-radius: 30px; border: 1px solid #333; }
        .dot { width: 12px; height: 12px; background: #333; border-radius: 50%; cursor: pointer; border: 1.5px solid gold; transition: 0.3s; }
        .dot.active { background: gold; box-shadow: 0 0 10px gold; transform: scale(1.3); }

        .card { background: #111; border: 1px solid #333; border-radius: 15px; padding: 15px; margin-bottom: 20px; border-left: 5px solid gold; }
        h2 { color: gold; font-size: 14px; text-transform: uppercase; margin: 0 0 10px 0; border-bottom: 1px solid #222; padding-bottom: 8px; }
        
        table { width: 100%; border-collapse: collapse; font-size: 12px; }
        th { background: #222; color: gold; padding: 10px; text-align: left; }
        td { padding: 10px; border-bottom: 1px solid #222; }

        .btn { padding: 10px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 11px; transition: 0.3s; }
        .btn-win { background: #2ecc71; color: #000; }
        .btn-lose { background: #e74c3c; color: #fff; }
        .btn-blue { background: #3498db; color: #fff; width: 100%; margin-top: 10px; }
        .btn-save { width: 100%; padding: 15px; background: #2ecc71; color: #000; border: none; border-radius: 10px; font-weight: bold; margin-top: 10px; }

        input { width: 100%; padding: 12px; margin: 8px 0; background: #222; border: 1px solid #444; border-radius: 8px; color: #fff; box-sizing: border-box; }
        
        .switch { position: relative; display: inline-block; width: 45px; height: 22px; float: right; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #444; transition: .4s; border-radius: 20px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #2ecc71; }
        input:checked + .slider:before { transform: translateX(23px); }
        .qr-preview-img { width: 120px; height: 120px; object-fit: contain; margin-top: 10px; background: #fff; border-radius: 5px; display: none; margin: 10px auto; }
    </style>
</head>
<body>

    <div class="nav-bar">
        <div class="dot active" onclick="gotoPage(0, this)"></div>
        <div class="dot" onclick="gotoPage(1, this)"></div>
        <div class="dot" onclick="gotoPage(2, this)"></div>
        <div class="dot" onclick="gotoPage(3, this)"></div>
    </div>

    <div class="main-wrapper" id="master-wrapper">
        
        <div class="page">
            <div class="card">
                <h2>üêâ DRAGON TIGER & TIE</h2>
                <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px;">
                    <button class="btn btn-win" onclick="setRes('dragon_tiger','Dragon')">Dragon</button>
                    <button class="btn btn-lose" onclick="setRes('dragon_tiger','Tiger')">Tiger</button>
                    <button class="btn" style="background:#9b59b6; color:#fff;" onclick="setRes('dragon_tiger','Tie')">Tie</button>
                </div>
                <button class="btn btn-blue" onclick="setRes('dragon_tiger','Auto')">SET AUTO MODE (DT)</button>
            </div>

            <div class="card" style="border-left-color: gold;">
                <h2>üí∞ QUICK ADD/CUT MONEY</h2>
                <input type="number" id="quick-phone" placeholder="Player Phone Number">
                <input type="number" id="quick-amount" placeholder="Amount (‚Çπ)">
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:5px;">
                    <button class="btn btn-win" onclick="quickWallet('add')">+ ADD MONEY</button>
                    <button class="btn btn-lose" onclick="quickWallet('cut')">- CUT MONEY</button>
                </div>
            </div>

            <div class="card">
                <h2>üÉè ANDAR BAHAR</h2>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                    <button class="btn btn-win" onclick="setRes('andar_bahar','Andar')">Andar</button>
                    <button class="btn btn-lose" onclick="setRes('andar_bahar','Bahar')">Bahar</button>
                </div>
                <button class="btn btn-blue" onclick="setRes('andar_bahar','Auto')">SET AUTO MODE (AB)</button>
            </div>
        </div>

        <div class="page">
            <div class="card" style="border-left-color: #3498db;">
                <h2>‚öôÔ∏è APP GLOBAL SETUP</h2>
                <div style="margin-bottom: 15px; overflow: hidden;">
                    <span style="font-size: 13px; color: gold;">Show QR to Players?</span>
                    <label class="switch"><input type="checkbox" id="qrStatus"><span class="slider"></span></label>
                </div>
                <label>UPI ID</label><input type="text" id="upiId" placeholder="example@ybl">
                <label>Direct QR Photo Upload</label>
                <input type="file" id="qrFile" accept="image/*" onchange="previewAndConvert(this)">
                <img id="qrPreview" class="qr-preview-img">
                <label>WhatsApp Link</label><input type="text" id="waNo">
                <label>Telegram Link</label><input type="text" id="tgLink">
                <label>Notice Board</label><input type="text" id="notif">
                <button class="btn-save" onclick="saveAll()">Save All Settings</button>
            </div>
        </div>

        <div class="page">
            <div class="card" style="border-left-color: #e67e22;">
                <h2>üì© PENDING REQUESTS</h2>
                <div style="overflow-x: auto;">
                    <table>
                        <thead><tr><th>TYPE</th><th>PHONE</th><th>AMT</th><th>INFO</th><th>ACTION</th></tr></thead>
                        <tbody id="req-body"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="page">
            <div class="card" style="border-left-color: #2ecc71;">
                <h2>üë• PLAYERS LIST <span id="p-count" style="float:right; color:gold;">0</span></h2>
                <input type="text" id="pSearch" placeholder="Search number..." onkeyup="filterPlayers()">
                <div style="max-height: 70vh; overflow-y: auto;">
                    <table id="p-table"><thead><tr><th>Phone</th><th>Balance</th></tr></thead><tbody id="p-list-body"></tbody></table>
                </div>
            </div>
        </div>

    </div>

<script>
    const firebaseConfig = { 
        apiKey: "AIzaSyCy2zsDDJeVTQEbHCenkLIlz3lWWyo-Pqo", 
        databaseURL: "https://kalyan-casino-default-rtdb.firebaseio.com", 
        projectId: "kalyan-casino" 
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let base64Image = "";

    function previewAndConvert(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = (e) => { base64Image = e.target.result; document.getElementById('qrPreview').src = base64Image; document.getElementById('qrPreview').style.display = "block"; };
            reader.readAsDataURL(input.files[0]);
        }
    }

    function gotoPage(i, dot) {
        document.getElementById('master-wrapper').style.transform = `translateX(-${i * 100}vw)`;
        document.querySelectorAll('.dot').forEach(d => d.classList.remove('active'));
        dot.classList.add('active');
    }

    function setRes(g, r) { 
        const mode = (r === 'Auto') ? 'AUTO' : 'MANUAL';
        db.ref('game_controls/'+g).set({next_result: r, mode: mode}); 
        alert(g + " set to " + r); 
    }

    function saveAll() {
        db.ref('admin_settings/payment').update({ upi_id: document.getElementById('upiId').value, qr_url: base64Image, show_qr: document.getElementById('qrStatus').checked });
        db.ref('admin_settings/support').update({ whatsapp: document.getElementById('waNo').value, telegram: document.getElementById('tgLink').value });
        db.ref('admin_settings/notification').set(document.getElementById('notif').value);
        alert("‚úÖ Updated!");
    }

    // Requests List
    db.ref('requests').on('value', snap => {
        const body = document.getElementById('req-body'); body.innerHTML = "";
        if(!snap.exists()) { body.innerHTML = "<tr><td colspan='5'>No Requests.</td></tr>"; return; }
        snap.forEach(child => {
            const r = child.val();
            body.innerHTML += `<tr>
                <td style="color:${r.type==='WITHDRAWAL'?'#e74c3c':'#2ecc71'}"><b>${r.type}</b></td>
                <td>${r.phone}</td><td>‚Çπ${r.amount}</td>
                <td>${r.upi ? 'UPI' : `<button class="btn btn-blue" style="width:auto; padding:5px" onclick="window.open('${r.image}')">SS</button>`}</td>
                <td>
                    <button class="btn btn-win" onclick="walletAction('${r.phone}', ${r.amount}, 'add', '${child.key}')">+</button>
                    <button class="btn btn-lose" onclick="walletAction('${r.phone}', ${r.amount}, 'cut', '${child.key}')">-</button>
                </td></tr>`;
        });
    });

    function walletAction(ph, amt, type, key) {
        db.ref('users/' + ph + '/balance').transaction(b => (parseFloat(b)||0) + (type === 'add' ? parseFloat(amt) : -parseFloat(amt)), (err, comm) => {
            if(comm) { if(key) db.ref('requests/'+key).remove(); alert("Wallet Updated!"); }
        });
    }

    function quickWallet(type) {
        const qp = document.getElementById('quick-phone').value;
        const qa = document.getElementById('quick-amount').value;
        if(!qp || !qa) { alert("Fill all details!"); return; }
        walletAction(qp, qa, type, null);
    }

    // Setup Load
    db.ref('admin_settings/payment').on('value', snap => {
        const d = snap.val(); if(!d) return;
        document.getElementById('upiId').value = d.upi_id || "";
        document.getElementById('qrStatus').checked = d.show_qr || false;
        if(d.qr_url) { base64Image = d.qr_url; document.getElementById('qrPreview').src = d.qr_url; document.getElementById('qrPreview').style.display = "block"; }
    });

    db.ref('users').on('value', snap => {
        const body = document.getElementById('p-list-body');
        document.getElementById('p-count').innerText = snap.numChildren();
        body.innerHTML = "";
        snap.forEach(p => {
            const bal = (parseFloat(p.val().balance||0) + parseFloat(p.val().winning_balance||0)).toFixed(2);
            body.innerHTML += `<tr><td>${p.key}</td><td style="color:#2ecc71;">‚Çπ${bal}</td></tr>`;
        });
    });
</script>
</body>
</html>
