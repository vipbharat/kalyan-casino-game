<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIP Bharat Casino</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; text-align: center; padding-top: 50px; }
        .box { background: #111; padding: 25px; border-radius: 15px; width: 300px; margin: auto; border: 1px solid #333; }
        input { width: 90%; padding: 12px; margin: 10px 0; background: #222; border: 1px solid #444; color: #fff; border-radius: 8px; outline: none; }
        button { width: 90%; padding: 14px; background: #ffd700; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; color: #000; margin-top: 10px; }
        button:disabled { background: #444; color: #888; }
        .hidden { display: none; }
        #otp-show { border: 1px dashed #ffd700; padding: 10px; margin: 10px 0; color: #ffd700; font-size: 20px; font-weight: bold; }
    </style>
</head>
<body>

<div class="box">
    <div id="tab-area" style="display:flex; margin-bottom:20px;">
        <div style="flex:1; cursor:pointer; color:#ffd700;" onclick="window.sw('l')">LOGIN</div>
        <div style="flex:1; cursor:pointer;" onclick="window.sw('r')">REGISTER</div>
    </div>

    <div id="login-sec">
        <input type="number" id="lph" placeholder="Mobile Number">
        <input type="password" id="lps" placeholder="Password">
        <button onclick="window.doLogin()">LOGIN NOW</button>
    </div>

    <div id="reg-sec" class="hidden">
        <input type="number" id="rph" placeholder="Mobile Number">
        <div id="ext" class="hidden">
            <div id="otp-show">OTP: <span id="val">000000</span></div>
            <input type="number" id="rotp" placeholder="Enter OTP">
            <input type="password" id="rp1" placeholder="Create Password">
            <input type="password" id="rp2" placeholder="Confirm Password">
        </div>
        <div id="msg" style="color:#0f0; margin:10px 0; font-size:12px;"></div>
        <button id="mainBtn" onclick="window.sendOTP()">SEND OTP</button>
    </div>
</div>

<script>
    // 1. Initialize Firebase
    var config = { 
        apiKey: "AIzaSyCy2zsDDJeVTQEbHCenkLIlz3lWWyo-Pqo", 
        databaseURL: "https://kalyan-casino-default-rtdb.firebaseio.com" 
    };
    if (!firebase.apps.length) { firebase.initializeApp(config); }
    var db = firebase.database();
    var correctOTP = "";

    // 2. Attach Functions to Window (GitHub Fix)
    window.sw = function(s) {
        document.getElementById('login-sec').classList.toggle('hidden', s === 'r');
        document.getElementById('reg-sec').classList.toggle('hidden', s === 'l');
    };

    window.sendOTP = function() {
        var ph = document.getElementById('rph').value;
        if(ph.length < 10) return alert("10 anko ka number!");

        var btn = document.getElementById('mainBtn');
        var msg = document.getElementById('msg');
        btn.disabled = true;
        var time = 10;

        var timer = setInterval(function() {
            msg.innerText = "⏳ System Generating OTP: " + time + "s";
            time--;
            if(time < 0) {
                clearInterval(timer);
                msg.innerText = "✅ OTP SUCCESS!";
                correctOTP = Math.floor(100000 + Math.random() * 899999).toString();
                document.getElementById('val').innerText = correctOTP;
                document.getElementById('ext').classList.remove('hidden');
                btn.disabled = false;
                btn.innerText = "VERIFY & REGISTER";
                btn.onclick = window.doRegister;
            }
        }, 1000);
    };

    window.doRegister = function() {
        var ph = document.getElementById('rph').value;
        var otp = document.getElementById('rotp').value;
        var p1 = document.getElementById('rp1').value;
        var p2 = document.getElementById('rp2').value;

        if(otp !== correctOTP) return alert("Galat OTP!");
        if(p1 === "" || p1 !== p2) return alert("Password match nahi!");

        var uid = "VIP" + Math.floor(100000 + Math.random() * 899999);
        db.ref('users/' + ph).set({
            phone: ph, password: p1, pass: p1, balance: 51, uid: uid
        }).then(function() {
            localStorage.setItem('userPhone', ph);
            window.location.href = "dashboard.html";
        });
    };

    window.doLogin = function() {
        var ph = document.getElementById('lph').value;
        var ps = document.getElementById('lps').value;
        db.ref('users/' + ph).once('value').then(function(snap) {
            if(snap.exists()) {
                var u = snap.val();
                if(u.password == ps || u.pass == ps) {
                    localStorage.setItem('userPhone', ph);
                    window.location.href = "dashboard.html";
                } else { alert("Galat Password!"); }
            } else { alert("Account nahi mila!"); }
        });
    };
</script>
</body>
</html>
